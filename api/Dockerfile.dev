FROM node:24-alpine

WORKDIR /app

COPY api/package.json api/yarn.lock ./
RUN yarn install --frozen-lockfile --ignore-scripts

# Copy Prisma schema (will be overridden by volume mount)
COPY database/prisma ./prisma
COPY database/prisma.config.ts ./prisma.config.ts

EXPOSE 3000

# Regenerate Prisma client on startup (handles schema changes via volume mount)
CMD ["sh", "-c", "yarn prisma generate --schema=./prisma/schema.prisma && yarn dev"]
